\documentclass{beamer}
\usetheme{ttuStatsCamp}
\usefonttheme{serif}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{url}
\usepackage{graphicx}
\usepackage{setspace}
\usepackage[natbibapa]{apacite}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{Sweavel}
\usepackage{listings}

\def\Sweavesize{\scriptsize}
\def\Rcolor{\color{black}}
%\def\Routcolor{\color{red}}
\def\Rcommentcolor{\color{violet}}
\def\Rbackground{\color[gray]{0.85}}
\def\Routbackground{\color[gray]{0.85}}

\lstset{tabsize=2, breaklines=true, style=Rstyle}

\SweaveOpts{keep.source=T, prefix.string=sweaveFiles/, split=T, ae=F, height=4, width=6}

\newcommand{\red}[0]{\textcolor{red}}
\newcommand{\green}[0]{\textcolor{green}}
\newcommand{\blue}[0]{\textcolor{blue}}
\newcommand{\comment}[1]{}
\newcommand{\va}[0]{\vspace{12pt}}
\newcommand{\vb}[0]{\vspace{6pt}}
\newcommand{\vc}[0]{\vspace{3pt}}
\newcommand{\vx}[1]{\vspace{#1pt}}

\title[Lecture 6]{Lecture 6: Longitudinal Mediation}

\author{Kyle M. Lang}

\institute[TTU IMMAP]{
  Institute for Measurement, Methodology, Analysis \& Policy\\
  Texas Tech University\\
  Lubbock, TX
}

\date{2016 Stats Camp}

\setbeamertemplate{frametitle continuation}{}

\begin{document}

\setkeys{Gin}{width=\textwidth}

<<echo=F>>=
options(width=160, prompt=" ", continue=" ", useFancyQuotes = TRUE)
nBoot <- 2000
@



\begin{frame}[plain]

  \titlepage
  
\end{frame}



\begin{frame}{Outline}

  \begin{itemize}
  \item Show how to test indirect effects with longitudinal models
    \va
  \item Briefly discuss causal inference
    \va
  \item Discuss how to make \emph{more} causal conclusions about
    mediation
  \end{itemize}

\end{frame}



\begin{frame}{Simplest Longitudinal Model}

  \begin{figure}
    \includegraphics[width=\textwidth]{figures/twoWaveStructure.pdf}
  \end{figure}

\end{frame}



\begin{frame}{Better Longitudinal Model}

  \begin{figure}
    \includegraphics[width=\textwidth]{figures/threeWaveStructure.pdf}
  \end{figure}

\end{frame}


\begin{frame}{With Experimental Manipulation}

  \begin{figure}
    \includegraphics[width=\textwidth]{figures/threeWaveExpStructure.pdf}
  \end{figure}

\end{frame}



\begin{frame}{With Mediated Paths}

  \begin{figure}
    \includegraphics[width=\textwidth]{figures/twoWaveStructure2.pdf}
  \end{figure}

\end{frame}



\begin{frame}{With Mediated Paths}

  \begin{figure}
    \includegraphics[width=\textwidth]{figures/threeWaveStructure2.pdf}
  \end{figure}

\end{frame}


\begin{frame}{Alternative c' Path}

  \begin{figure}
    \includegraphics[width=\textwidth]{figures/threeWaveStructure3.pdf}
  \end{figure}

\end{frame}



\begin{frame}{Experimental Model}

  \begin{figure}
    \includegraphics[width=\textwidth]{figures/threeWaveExpStructure2.pdf}
  \end{figure}

\end{frame}



\begin{frame}{Let's Try It}

  \begin{figure}
    \includegraphics[width=\textwidth]{figures/examplePathDiagram.pdf}
  \end{figure}

\end{frame}


\begin{frame}[allowframebreaks]{Example}

<<>>=
library(lavaan)

dataDir <- "../data/"

dat1 <- readRDS(paste0(dataDir, "unicorn2.rds"))

mod1 <- "
att3 ~ att2 + b2*conf2 + cp2*horn2
att2 ~ att1 + b1*conf1 + cp1*horn1

conf3 ~ conf2 + a2*horn2
conf2 ~ conf1 + a1*horn1

horn3 ~ horn2
horn2 ~ horn1

horn3 ~~ conf3 + att3
conf3 ~~ att3

horn2 ~~ conf2 + att2
conf2 ~~ att2

ab1 := a1*b1
ab2 := a2*b2
"

out1 <- sem(mod1, data = dat1, se = "boot", boot = nBoot)
summary(out1)
parameterEstimates(out1, boot = "bca.simple")[ , -c(1 : 3)]
@

\end{frame}


\begin{frame}[allowframebreaks]{Example}
  
<<>>=
mod2 <- "
att3 ~ att2 + b2*conf2 + cp*horn1
att2 ~ att1 + b1*conf1

conf3 ~ conf2 + a2*horn2
conf2 ~ conf1 + a1*horn1

horn3 ~ horn2
horn2 ~ horn1

horn3 ~~ conf3 + att3
conf3 ~~ att3

horn2 ~~ conf2 + att2
conf2 ~~ att2

ab := a1*b2
"

out2 <- sem(mod2, data = dat1, se = "boot", boot = nBoot)
summary(out2)
parameterEstimates(out2, boot = "bca.simple")[ , -c(1 : 3)]
@ 

\end{frame}



\begin{frame}{Assumptions}
  
  We need a few assumptions to fully generalize our findings:
  \vb
  \begin{itemize} 
  \item \textsc{Stability:} Do mean levels follow a stable trend?  
    \vb
  \item \textsc{Stationarity:} Are lagged associations equal for
    equivelent lags?  
    \vb
  \item \textsc{Equilibrium:} Are cross-sectional variances and
    covariances euqal at all waves?
  \end{itemize}
  \va
  Another definition of stationarity is used in time-series analysis:
  \begin{itemize}
  \item \textsc{Weak Stationarity:}
    \vc
    \begin{enumerate}
    \item Finite variance
      \vc
    \item No trend in mean levels
      \vc
    \item Lag-$K$ auto-covariances are equal
    \end{enumerate}
    \vb
  \item \textsc{Strict Stationarity:} The distribution of the process is
    the same at all time points.
  \end{itemize}
  
\end{frame}


\begin{frame}[allowframebreaks]{Test Assumptions}
  
<<>>=
mod3 <- "
att3 ~ att2 + b2*conf2 + cp2*horn2
att2 ~ att1 + b1*conf1 + cp1*horn1

conf3 ~ conf2 + a2*horn2
conf2 ~ conf1 + a1*horn1

horn3 ~ horn2
horn2 ~ horn1

horn3 ~~ conf3 + att3
conf3 ~~ att3

horn2 ~~ conf2 + att2
conf2 ~~ att2

a1 == a2
b1 == b2
cp1 == cp2
"

out3 <- sem(mod3, data = dat1)
summary(out3)

chiDiff <- fitMeasures(out3)["chisq"] -
    fitMeasures(out1)["chisq"]

dfDiff <- fitMeasures(out3)["df"] -
    fitMeasures(out1)["df"]

pchisq(chiDiff, dfDiff, lower = FALSE)
@ 

\end{frame}



\begin{frame}{Weirdness of Causation}

  Causal modeling/inference is underpinned by an odd contradiction:
  \va
  \begin{itemize}
  \item Correlation does not exist in the real world
    \va
  \item An observed correlation is merely an artifact of inadequate
    measurement.
    \vb
  \item If $X$ and $Y$ covary, then there are three possible
    \emph{underlying} reasons:
    \vb
    \begin{enumerate}
    \item $X$ causes $Y$
      \vc
    \item $Y$ causes $X$
      \vc
    \item An unmeasured third variable causes both $X$ and $Y$
    \end{enumerate}
  \end{itemize}
  
\end{frame}



\begin{frame}{Weirdness of Causation}
  
  \begin{itemize}
  \item Probability theory and statistical analysis can only encode
    correlational relations
    \va
    \begin{itemize}
    \item Probability theory can only describe the (in)dependence of $X$
      and $Y$ in terms of their joint distribution.
      \vb
    \item Statistics can only test for a (non)linear association between
      $X$ and $Y$.
    \end{itemize}
    \va
  \item Causal information must be externally imposed by the researcher
    in the form of assumptions and theory.
  \end{itemize}
  
\end{frame}



\begin{frame}{Sufficient Conditions to Infer Causation}

  Three conditions are generally sufficient to suggest that $X$ causes
  $Y$:
  \vb
  \begin{enumerate}
  \item $X$ and $Y$ must covary
    \vb
  \item $X$ must temporally precede $Y$
    \vb
  \item All alternative explanations for the covariance of $X$ and $Y$
    must be eliminated
  \end{enumerate}
  \va
  \pause
  Condition 1 is easy to confirm in any data analytic context.\\
  \va
  Condition 2 can be easily assessed with longitudinal data.\\
  \va
  Condition 3 is impossible to satisfy statistically.
  \begin{itemize}
    \vb
  \item Even the most rigorous experimental designs must make
    assumptions to satisfy Condition 3.
    \vb
  \item Tenability decreases without random assignment.
  \end{itemize}

\end{frame}



\begin{frame}{What do Longitudinal Data Give Us?}
  
  \textsc{Question:} Do we get to claim causation if we find
  mediation with a panel model?\\ 
  \va 
  \pause 
  \textsc{Answer:} No!\\ 
  \va
  \pause 
  But we can make stronger claims than we can with
  cross-sectional data.
  \vb
  \begin{itemize}
  \item Panel models can satisfy Conditions 1 and 2.
    \vb
  \item Panel models can help with Condition 3
    \begin{itemize}
    \item Due to the autoregressive paths, each case acts as its own
      control
      \vb
    \item Autoregression only controls for time-invariant traits
    \end{itemize}
    \vb
  \item We can further improve the strengths of our inferences by
    including appropriate covariates
    \vc
    \begin{itemize}
    \item Same idea as matching non-experimental cases for causal inference
    \end{itemize}
  \end{itemize}
  
\end{frame}


\begin{frame}[allowframebreaks]{Example}
  
<<>>=
mod4 <- "
att3 ~ att2 + b2*conf2 + cp*horn1
att2 ~ att1 + b1*conf1

conf3 ~ conf2 + a2*horn2
conf2 ~ conf1 + a1*horn1

att2 + att3 ~ income
conf2 + conf3 ~ income 
horn2 + horn3 ~ income

horn3 ~ horn2
horn2 ~ horn1

horn3 ~~ conf3 + att3
conf3 ~~ att3

horn2 ~~ conf2 + att2
conf2 ~~ att2

ab := a1*b2
"

out4 <- sem(mod4, data = dat1, se = "boot", boot = nBoot)
summary(out4)
parameterEstimates(out4, boot = "bca.simple")[ , -c(1 : 3)]
@ 

\end{frame}


\end{document}
